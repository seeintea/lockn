# 家庭财务管理系统（前后端分离）PRD（功能梳理版）

> 目标：帮助家庭成员统一记录收支/资产负债，形成预算与报表，提升记账效率与资金透明度，同时保证隐私与权限隔离。

## 1. 背景与目标

### 1.1 背景
- 家庭收支来源多（工资、兼职、理财、红包、退款等），消费场景复杂（餐饮、育儿、房贷等），依靠手工表格维护成本高、口径难统一。
- 家庭成员之间需要共享与协作（共同预算、共同支出、对账），但也存在隐私（个人收入、个人资产）与权限边界。

### 1.2 产品目标
- 低成本、可持续的记账：随手记、自动导入、模板化、提醒。
- 可视化洞察：按月/按人/按类别/按账户的趋势、结构、预算执行。
- 协作与权限：家庭账本共享、成员角色、可见范围可控。
- 数据安全：加密、最小化授权、审计与可追溯、可备份与可导出。

### 1.3 非目标（本阶段不做/后续再做）
- 复杂投资组合分析（期权、期货、税务申报）
- 个人征信/银行直连自动同步（可作为未来增强）

## 2. 用户与角色

### 2.1 角色
- 家庭创建者（Owner）：创建家庭/账本、邀请成员、权限管理、数据导出与删除。
- 管理员（Admin）：可管理分类、预算、账户等配置。
- 成员（Member）：记账、查看被授权的数据。
- 访客（Guest，可选）：只读（例如只看报表）。

### 2.2 核心场景
- 日常随手记一笔（快速录入/语音转文本/模板）
- 月度复盘（预算执行、结构分析、异常提醒）
- 家庭协作（共同预算、共同账户、成员分摊）
- 对账（银行流水导入、重复/遗漏识别、差异处理）

## 3. 产品信息架构（功能模块拆分）

### 3.1 账户与家庭
- 家庭/账本管理
  - 创建家庭（名称、默认币种、时区）
  - 创建账本（家庭账本/个人账本/项目账本）
  - 账本归属与共享策略
- 成员管理
  - 邀请/加入/移除成员
  - 成员角色（Owner/Admin/Member/Guest）
  - 成员可见范围（全部/仅本人/指定账户/指定分类）
- 审计日志（关键操作记录）
  - 邀请、权限变更、删除、导出、批量导入等

### 3.2 账户体系（资金载体）
- 账户（Account）
  - 账户类型：现金、银行卡、信用卡、支付平台、储值卡、借贷账户等
  - 余额与币种、信用卡账单日/还款日（可选）
  - 账户状态：启用/停用
- 转账（Transfer）
  - 账户A -> 账户B 转账
  - 手续费记录（可拆分为费用支出）
- 余额校准（Balance Adjustment）
  - 对账差异时的校准（记录原因与审计）

### 3.3 分类与标签（口径）
- 收入/支出分类（Category）
  - 树形分类（一级/二级/多级）
  - 系统默认分类 + 自定义分类
  - 分类映射（导入时映射）
- 标签（Tag）
  - 多标签：育儿/旅行/车险/公司报销等
  - 标签统计与热度

### 3.4 交易流水（核心业务）
- 交易类型
  - 支出（Expense）
  - 收入（Income）
  - 转账（Transfer）
  - 调整（Adjustment）
- 交易字段（统一模型）
  - 金额、币种、时间、账户、分类、标签、成员（记账人/归属人）
  - 备注、图片附件（小票）、位置（可选）
  - 是否报销/待报销（可选）
  - 关联交易（退款/冲正/分摊/分期）
- 高级录入能力
  - 快速模板（常用交易一键填充）
  - 拆分交易（一次消费拆成多分类）
  - 定期交易（房租/会员订阅自动生成）
  - 批量编辑（改分类/标签/归属人）
  - 搜索与过滤（时间、金额范围、账户、分类、标签、成员、关键字）

### 3.5 预算与目标
- 预算（Budget）
  - 按月预算：总预算、分类预算、成员预算（可选）
  - 预算口径：仅支出/净支出（收入抵扣）等策略
  - 预算告警：达到 80%/100% 推送
- 目标（Goal，可选）
  - 存钱目标（买车/旅游）：目标金额、截止日期、进度

### 3.6 报表与分析
- 概览 Dashboard
  - 本月收/支/结余、同比/环比
  - 预算执行（总/分类）
  - 账户余额与变化
- 结构报表
  - 支出分类结构（饼图/旭日图）
  - 标签结构
- 趋势报表
  - 月度趋势、周趋势、成员趋势
- 明细报表
  - 可导出 CSV/Excel
- 异常洞察（可选）
  - 大额支出提醒、重复扣款、订阅涨价等

### 3.7 资产与负债（进阶）
- 资产（Asset）
  - 现金类/投资类/实物类（房产、车辆）
  - 估值记录与折旧（可选）
- 负债（Liability）
  - 房贷/车贷/信用卡欠款/个人借贷
  - 还款计划与提醒（可选）
- 净资产（Net Worth）
  - 按月快照、趋势

### 3.8 导入导出与对账
- 导入
  - 支持常见平台 CSV（支付宝/微信/银行卡）
  - 字段映射、分类映射、去重规则（hash/时间+金额+描述）
  - 预览与回滚
- 对账
  - 对账期选择、差异列表（缺失/重复/金额不一致）
  - 一键补录/忽略/合并
- 导出
  - 账本导出（CSV/JSON），支持按时间区间
  - 家庭数据备份与恢复（管理员权限）

### 3.9 通知与提醒
- 预算告警
- 定期交易生成提醒
- 账单日/还款日提醒（信用卡）
- 成员协作提醒（待确认分摊/待对账）

### 3.10 权限与安全（后端核心）
- 认证（Auth）
  - 登录/登出/刷新（可选）
  - 多端登录策略（单点/多点，策略可配置）
- 授权（Authorization）
  - 基于角色 + 资源范围（账本/账户/分类）
  - 接口级权限点（如 `sys:menu:create` 这类）
- 数据安全
  - 传输加密（HTTPS）
  - 敏感字段加密存储（可选：手机号、邮箱等）
  - 操作审计、风控（登录失败次数、IP 黑名单可选）

## 4. 前端（Web/移动端）功能拆分

### 4.1 页面与导航（建议）
- 登录/注册（如需要）、验证码（如需要）
- 家庭/账本切换
- 首页概览（Dashboard）
- 记一笔（快速录入/拆分/模板）
- 流水列表（筛选/搜索/编辑/批量）
- 账户管理（余额、转账、对账）
- 分类与标签管理
- 预算管理与提醒设置
- 报表中心
- 导入/导出
- 成员与权限管理（Owner/Admin）
- 系统设置（币种、时区、数据备份、隐私）

### 4.2 交互与体验要点
- 快速录入：默认账户/默认分类/最近一次输入记忆
- 列表高性能：虚拟滚动、分页、增量加载
- 可回滚：导入/批量操作提供撤销（后端保留批次号）

## 5. 后端（API）功能拆分（前后端分离）

### 5.1 领域服务建议（模块化）
- Auth：登录、登出、Token、会话管理
- Family/Book：家庭、账本、成员、权限范围
- Account：账户、转账、余额校准
- Category/Tag：分类、标签
- Transaction：流水、拆分、搜索
- Budget：预算、预算规则、告警
- Report：聚合报表接口（按维度查询）
- Import/Export：导入任务、导出任务、对账任务
- Admin：系统字典、审计日志

### 5.2 API 设计原则
- REST 风格 + 分页统一（page/pageSize）
- 写操作幂等（导入/批量建议提供 requestId）
- 统一响应结构（code/message/data）
- 权限点与资源范围同时校验

## 6. 数据模型（概念层）

> 仅列关键实体，便于前后端对齐字段与关系。

- family(id, name, currency, timezone, ownerId, ...)
- book(id, familyId, name, type, ...)
- member(id, familyId, userId, role, scope, ...)
- account(id, bookId, name, type, currency, balance, ...)
- category(id, bookId, type[income/expense], parentId, name, ...)
- tag(id, bookId, name, ...)
- transaction(id, bookId, type, amount, currency, accountId, categoryId, tagIds, occurredAt, ownerUserId, createdBy, ...)
- transaction_split(id, transactionId, categoryId, amount, ...)
- budget(id, bookId, month, total, rules, ...)
- import_task(id, bookId, source, status, mapping, ...)
- audit_log(id, actorId, action, target, payload, createdAt, ...)

## 7. 版本规划（建议）

### 7.1 MVP（1.0）
- 账本/成员（基础协作）
- 分类/账户（基础配置）
- 收入/支出/转账流水（含搜索与过滤）
- 月度概览 + 分类结构报表
- CSV 导入（至少一种平台）+ 去重
- 基础权限（账本级可见、接口权限点）

### 7.2 1.1
- 预算与告警
- 定期交易
- 导出与审计日志

### 7.3 2.0
- 资产负债与净资产
- 对账中心（差异处理）
- 异常洞察与订阅管理

## 8. 关键边界与风控点
- 多币种：MVP 可先单币种；后续再支持自动汇率与折算
- 数据一致性：导入/批量操作需要事务或批次机制
- 权限：必须同时校验接口权限 + 资源范围（账本/账户/分类）
- 备份与删除：提供导出与“软删除 + 冷却期”策略（可选）

